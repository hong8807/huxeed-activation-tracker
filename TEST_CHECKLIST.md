# 📋 HUXEED 신규품목 활성화 시스템 - 전체 테스트 체크리스트

**프로젝트**: HUXEED Activation Tracking System
**버전**: v2.10 (관세 및 부대비용 추가)
**작성일**: 2025-11-06
**테스트 서버**: http://localhost:3005

---

## ✅ 완료된 테스트

### 1. 데이터베이스 초기화 ✅
- [x] targets: 0건
- [x] stage_history: 0건
- [x] suppliers: 0건
- [x] 스크립트: `scripts/reset-database.js`

### 2. 시스템 직접 입력 ✅
- [x] `/pipeline/add` 페이지 접근
- [x] 22개 필드 입력 폼 정상 표시
- [x] 자동 계산 (KRW 환산, 절감액, 절감률)
- [x] 통화 선택 드롭다운 (USD, EUR, CNY, JPY, KRW)
- [x] 환율 자동 조회 기능 (한국수출입은행 API)
- [x] 저장 후 MARKET_RESEARCH 단계로 생성

### 3. Pipeline 칸반보드 ✅
- [x] 12단계 칸반보드 표시
- [x] 드래그앤드롭 단계 이동
- [x] 단계 변경 메뉴 (점 3개)
- [x] 제조원 미등록 시 다음 단계 이동 제한
- [x] 에러 메시지: "제조원 정보를 먼저 등록해주세요"
- [x] 카드 삭제 기능 (CASCADE: stage_history, suppliers 함께 삭제)

### 4. 소싱 관리 ✅
- [x] `/pipeline/sourcing` 페이지 접근
- [x] 품목별 제조원 정보 리스팅
- [x] **연속 제조원 추가 기능** (모달이 닫히지 않음)
- [x] API 필터링 로직 수정 (SOURCING_REQUEST 외 단계도 허용)
- [x] 제조원 수정 기능
- [x] 관세율/부대비용율 입력 및 반영
- [x] 입력자명 표시
- [x] 자동완성 기능 (제조원명)
- [x] 좌측 패널에 저장된 제조원 즉시 표시 (낙관적 업데이트)

---

## 🔄 진행 중인 테스트

### Test 1: Dashboard KPI 및 차트

**테스트 페이지**: http://localhost:3005/dashboard

#### 1.1 KPI 카드 확인
- [ ] **평균 진척률(%)** - 전체 품목 평균 표시 확인
- [ ] **완료(WON) 건수** - WON 단계 개수 확인
- [ ] **Target매출액** - 백만원 단위 표시 확인
- [ ] **전략달성율(%)** - WON 매출 / Target매출 비율 확인

**검증 방법**:
```sql
-- Supabase SQL Editor에서 실행
SELECT
  COUNT(*) as total,
  AVG(stage_progress_rate) as avg_progress,
  SUM(CASE WHEN current_stage = 'WON' THEN 1 ELSE 0 END) as won_count,
  SUM(our_est_revenue_krw) / 1000000 as target_revenue_million,
  SUM(CASE WHEN current_stage = 'WON' THEN our_est_revenue_krw ELSE 0 END) / 1000000 as achieved_revenue_million
FROM targets;
```

#### 1.2 전략 카드 (S/P 세그먼트)
- [ ] **White Space 전략** 카드 표시 확인
- [ ] S 세그먼트 품목만 표시되는지 확인
- [ ] 예상매출액 합계 정확성
- [ ] **Erdosteine 전략** 카드 표시 확인
- [ ] P 세그먼트 품목만 표시되는지 확인
- [ ] 예상매출액 합계 정확성

**검증 방법**:
```sql
-- S 세그먼트 (White Space)
SELECT
  COUNT(*) as count,
  SUM(our_est_revenue_krw) / 1000000 as revenue_million
FROM targets
WHERE segment = 'S';

-- P 세그먼트 (Erdosteine)
SELECT
  COUNT(*) as count,
  SUM(our_est_revenue_krw) / 1000000 as revenue_million
FROM targets
WHERE segment = 'P';
```

#### 1.3 차트 시각화
- [ ] **단계별 진행 퍼널 차트** - 12단계 개수 표시
- [ ] **거래처별 진행률 막대그래프** - 거래처명 + 진행률
- [ ] **품목별 활성화 히트맵** - 색상으로 진행률 표시
- [ ] **절감액 Top10** - 상위 10개 품목 표시
- [ ] **평균 리드타임** - 단계별 평균 체류일

**검증 사항**:
- 차트가 정상적으로 렌더링되는지
- 데이터 개수가 DB와 일치하는지
- 색상 구분이 명확한지
- 레이블이 잘려 보이지 않는지

#### 1.4 데이터 정확성
- [ ] Dashboard 수치와 실제 DB 데이터 일치 확인
- [ ] 새로고침 시 최신 데이터 반영
- [ ] 품목 추가 후 Dashboard 즉시 반영 확인

---

## ⏳ 대기 중인 테스트

### Test 2: 환율 차트 기능

**테스트 페이지**: http://localhost:3005/pipeline/sourcing (하단 환율 테이블)

#### 2.1 환율 테이블 기본 기능
- [ ] 환율 테이블 표시 (USD, EUR, CNY, JPY)
- [ ] 7영업일 히스토리 표시
- [ ] 날짜 정렬 확인 (최신 → 과거)
- [ ] 금액 포맷 확인 (소수점 2자리)

#### 2.2 환율 종류 필터
- [ ] **매매기준율(deal_bas_r)** 선택 → 테이블 업데이트
- [ ] **전신환(송금) 받으실때(ttb)** 선택 → 테이블 업데이트
- [ ] **전신환(송금) 보내실때(tts)** 선택 → 테이블 업데이트
- [ ] 필터 변경 시 모든 통화 동시 업데이트
- [ ] 선택된 필터가 드롭다운에 표시

#### 2.3 환율 차트 모달
- [ ] **USD 클릭** → 30영업일 차트 모달 오픈
- [ ] **EUR 클릭** → 30영업일 차트 모달 오픈
- [ ] **CNY 클릭** → 30영업일 차트 모달 오픈
- [ ] **JPY 클릭** → 30영업일 차트 모달 오픈

**차트 디자인 확인**:
- [ ] 검은 배경 그라데이션 (`from-gray-900 via-gray-800 to-black`)
- [ ] 파란 라인 (`#4DA3FF`, stroke-width: 3)
- [ ] 부드러운 곡선 (Catmull-Rom Spline)
- [ ] 현재 환율 큰 글씨로 표시
- [ ] 변동률 표시 (▲ 빨강 / ▼ 초록)
- [ ] X축 날짜 레이블 표시 (MM/DD 형식)
- [ ] Y축 레이블 제거 확인
- [ ] 최소한의 그리드 라인

#### 2.4 환율 자동 조회
- [ ] 신규 품목 입력 시 통화 선택 → 환율 자동 설정
- [ ] 제조원 입력 시 통화 선택 → 환율 자동 설정
- [ ] KRW 선택 시 환율 1로 고정 (API 호출 X)
- [ ] API 실패 시 기본값 사용 (USD: 1430)
- [ ] 콘솔에서 환율 조회 로그 확인

**API 테스트**:
```bash
# 환율 조회 API 직접 테스트
curl "http://localhost:3005/api/exchange-rate?currency=USD"
curl "http://localhost:3005/api/exchange-rate?currency=EUR"
curl "http://localhost:3005/api/exchange-rate?currency=CNY"
curl "http://localhost:3005/api/exchange-rate?currency=JPY"

# 월간 환율 데이터 조회
curl "http://localhost:3005/api/exchange-rate-monthly?currency=USD&rateType=deal_bas_r"
```

---

### Test 3: 상세 모달 및 이력

**테스트 위치**: 칸반보드 카드 클릭

#### 3.1 품목 상세 모달 (TargetDetailModal)
- [ ] 칸반 카드 클릭 → 상세 모달 오픈
- [ ] 모달 닫기 버튼 동작

**기본정보 탭**:
- [ ] 거래처명 표시
- [ ] 품목명 표시
- [ ] 담당자명 표시
- [ ] 예상 수량(kg) 표시
- [ ] 세그먼트 표시 (S/P/일반)
- [ ] 2025년 매출액 표시

**가격 비교 탭**:
- [ ] 현재매입 정보 테이블
  - [ ] 통화 표시
  - [ ] 외화 단가 표시
  - [ ] 환율 표시
  - [ ] 관세율 표시
  - [ ] 부대비용율 표시
  - [ ] KRW 단가 표시 (관세+부대비용 반영)
- [ ] 우리예상 정보 테이블
  - [ ] 통화 표시
  - [ ] 외화 단가 표시
  - [ ] 환율 표시
  - [ ] 관세율 표시
  - [ ] 부대비용율 표시
  - [ ] KRW 단가 표시 (관세+부대비용 반영)

**절감 분석 탭**:
- [ ] 총 절감액 (백만원 단위)
- [ ] 절감률 (%)
- [ ] 절감액 그래프 (시각화)
- [ ] 음수 절감액 시 빨간색 표시

**제조원 정보 탭**:
- [ ] 등록된 제조원 목록 카드 형태 표시
- [ ] 각 제조원 정보:
  - [ ] 제조원명
  - [ ] 입력자명
  - [ ] 통화 + 외화 단가
  - [ ] 환율
  - [ ] 관세율(%)
  - [ ] 부대비용율(%)
  - [ ] 최종 KRW (관세+부대비용 반영)
  - [ ] DMF 등록 여부 (O/X)
  - [ ] 연계심사 상태 (준비중/진행중/완료)
  - [ ] 비고
- [ ] 제조원 0개 시 "제조원 정보가 없습니다" 메시지

**단계 이력 탭**:
- [ ] 타임라인 형태 표시
- [ ] 각 이력 항목:
  - [ ] 날짜/시간
  - [ ] 단계명 (한글)
  - [ ] 담당자명
  - [ ] 코멘트
- [ ] 최신 이력이 위에 표시 (내림차순)
- [ ] 단계 전환 시각화 (화살표 등)

#### 3.2 단계 변경 모달 (StageChangeModal)
- [ ] "다음 단계로 이동" 버튼 클릭 시 모달 오픈
- [ ] 현재 단계 표시
- [ ] 다음 단계 표시
- [ ] 코멘트 입력 필드 (선택사항)
- [ ] "변경" 버튼 클릭

**자동 처리 확인**:
- [ ] `current_stage` 업데이트
- [ ] `stage_updated_at` 현재 시간으로 업데이트
- [ ] `stage_progress_rate` 자동 계산
- [ ] `stage_history` 새 기록 추가
- [ ] 칸반보드 즉시 반영 (모달 닫힌 후)

**제조원 검증**:
- [ ] SOURCING_REQUEST → SOURCING_COMPLETED 이동 시
- [ ] 제조원 0개면 에러 메시지 표시
- [ ] 제조원 1개 이상이면 정상 이동

#### 3.3 제조원 정보 확인 모달 (SupplierInfoModal)
- [ ] SOURCING_COMPLETED 이후 카드에 "제조원 정보 확인" 버튼 표시
- [ ] 버튼 클릭 시 메모지 형태 모달 오픈
- [ ] 모든 제조원 정보 리스트 표시

**각 제조원 카드**:
- [ ] 제조원명 (헤더)
- [ ] 입력자: XXX
- [ ] 외화: USD $100 / 환율: 1,350
- [ ] 관세: 5% / 부대비용: 3%
- [ ] 최종 원가: ₩145,800
- [ ] DMF: O / 연계심사: 진행중
- [ ] 비고: XXX

**하단 안내**:
- [ ] "관련 제조원 추가 문의사항은 무역부에 요청주세요." 메시지

---

### Test 4: 리포트 PDF 생성

**테스트 페이지**: http://localhost:3005/report

#### 4.1 리포트 페이지 접근
- [ ] `/report` 페이지 정상 접근
- [ ] 리포트 미리보기 표시
- [ ] 모든 섹션 렌더링 확인

#### 4.2 리포트 내용 확인

**헤더**:
- [ ] "HUXEED 신규품목 활성화 현황 리포트" 제목
- [ ] 리포트 생성 날짜 표시

**KPI 섹션**:
- [ ] 신규등록 품목수
- [ ] 평균 진척률 (%)
- [ ] **Target매출액** (백만원)
- [ ] **예상 신규 매출액** (백만원)
- [ ] **전략달성율** (%)

**차트 섹션**:
- [ ] 단계별 진행 퍼널 차트
- [ ] 거래처별 진행률 막대그래프
- [ ] 절감액 Top10
- [ ] 평균 리드타임

**주요 지연 거래처**:
- [ ] 체류일 기준 상위 5개 거래처
- [ ] 거래처명, 품목명, 현재 단계, 체류일 표시

**액션 리스트**:
- [ ] 우선순위 상위 5개 품목
- [ ] 품목명, 현재 상태, 액션 항목 표시

#### 4.3 PDF 다운로드
- [ ] "PDF 다운로드" 버튼 표시
- [ ] 버튼 클릭 시 로딩 표시
- [ ] PDF 파일 자동 다운로드
- [ ] 파일명: `HUXEED_Activation_Report_YYYY-MM-DD.pdf`

**PDF 품질 확인**:
- [ ] 모든 텍스트 정상 표시 (한글 깨짐 없음)
- [ ] 차트 이미지 선명하게 포함
- [ ] 레이아웃 정상 (페이지 넘침 없음)
- [ ] 페이지 구분 적절
- [ ] 백만원 단위 표시 정확

**html2canvas + jsPDF 동작 확인**:
- [ ] 차트가 캡처되는지
- [ ] 스타일이 유지되는지
- [ ] 페이지 분할이 자연스러운지

---

### Test 5: 엣지 케이스 및 오류 처리

#### 5.1 빈 데이터 상태
- [ ] 품목 0개 시 Dashboard 빈 상태 표시
- [ ] "데이터가 없습니다" 메시지
- [ ] 차트 영역에 "데이터 없음" 표시
- [ ] KPI 카드에 0 또는 N/A 표시

#### 5.2 필수 필드 누락 검증

**신규 품목 입력**:
- [ ] 거래처명 누락 → "거래처명이 필요합니다" 에러
- [ ] 품목명 누락 → "품목명이 필요합니다" 에러
- [ ] 수량 0 또는 음수 → "유효한 수량을 입력하세요" 에러
- [ ] 담당자명 누락 → "담당자명이 필요합니다" 에러
- [ ] 통화 미선택 → "통화를 선택하세요" 에러
- [ ] 단가 0 또는 음수 → "유효한 단가를 입력하세요" 에러
- [ ] 환율 0 또는 음수 (KRW 제외) → "유효한 환율을 입력하세요" 에러

**제조원 입력**:
- [ ] 제조원명 누락 → "제조원명이 필요합니다" 에러
- [ ] 입력자명 누락 → "입력자명이 필요합니다" 에러
- [ ] 통화 미선택 → "통화를 선택하세요" 에러
- [ ] 단가 0 또는 음수 → "유효한 단가를 입력하세요" 에러
- [ ] 환율 0 또는 음수 (KRW 제외) → "유효한 환율을 입력하세요" 에러

#### 5.3 API 오류 처리

**환율 API 실패**:
- [ ] 환율 API 타임아웃 → 기본값 사용 (USD: 1430)
- [ ] 네트워크 에러 → 기본값 사용
- [ ] 잘못된 통화 코드 → 에러 메시지 표시
- [ ] 콘솔 에러 로그 확인

**Supabase API 실패**:
- [ ] 데이터 조회 실패 → "데이터를 불러올 수 없습니다" 에러
- [ ] 저장 실패 → "저장에 실패했습니다" 에러 + 재시도 안내
- [ ] 삭제 실패 → "삭제에 실패했습니다" 에러

#### 5.4 동시성 처리

**빠른 연속 클릭**:
- [ ] 저장 버튼 연속 클릭 시 중복 저장 방지
- [ ] 로딩 중 버튼 비활성화
- [ ] 스피너 표시

**여러 제조원 빠르게 저장**:
- [ ] 제조원 1 저장 → 제조원 2 즉시 저장 → 정상 동작
- [ ] 낙관적 업데이트로 즉시 UI 반영
- [ ] DB와 UI 동기화 확인

**단계 변경 중복**:
- [ ] 단계 변경 API 호출 중 재클릭 방지
- [ ] 모달 닫힘 전까지 다른 동작 제한

#### 5.5 권한 및 보안

**단계별 제한**:
- [ ] WON 단계 카드는 제조원 추가 불가
- [ ] LOST 단계 카드는 제조원 추가 불가
- [ ] ON_HOLD 단계 카드는 제조원 추가 불가
- [ ] 적절한 에러 메시지 표시

**CASCADE 삭제 동작**:
- [ ] 품목 삭제 시 확인 다이얼로그
- [ ] "⚠️ 단계 이력 및 제조원 정보도 함께 삭제됩니다." 경고
- [ ] 삭제 후 stage_history 함께 삭제 확인
- [ ] 삭제 후 suppliers 함께 삭제 확인

**데이터 정합성**:
- [ ] 제조원 없이 SOURCING_COMPLETED 단계로 직접 이동 불가
- [ ] 잘못된 단계 순서로 이동 불가 (예: WON → MARKET_RESEARCH)
- [ ] 음수 절감액 정상 처리 및 표시

#### 5.6 성능 테스트

**대량 데이터**:
- [ ] 품목 100개 이상 시 칸반보드 렌더링 성능
- [ ] 제조원 50개 이상 품목의 상세 모달 오픈 속도
- [ ] Dashboard 차트 렌더링 속도 (<3초)

**네트워크 지연**:
- [ ] 느린 네트워크에서 로딩 스피너 표시
- [ ] 타임아웃 설정 확인 (30초)
- [ ] 재시도 로직 동작 확인

---

## 📊 테스트 결과 기록

### 성공 ✅
| 테스트 항목 | 결과 | 날짜 | 비고 |
|------------|------|------|------|
| 데이터베이스 초기화 | ✅ 성공 | 2025-11-06 | 모든 테이블 0건 |
| 시스템 직접 입력 | ✅ 성공 | 2025-11-06 | 통화 자동완성 포함 |
| Pipeline 칸반보드 | ✅ 성공 | 2025-11-06 | 드래그앤드롭, 삭제 |
| 소싱 관리 | ✅ 성공 | 2025-11-06 | 연속 추가 기능 수정 |
| | | | |

### 실패 ❌
| 테스트 항목 | 오류 내용 | 날짜 | 해결 방안 |
|------------|----------|------|----------|
| | | | |

### 부분성공 ⚠️
| 테스트 항목 | 이슈 | 날짜 | 개선 필요 사항 |
|------------|------|------|---------------|
| | | | |

---

## 🎯 다음 단계

1. **Dashboard KPI 테스트** (현재 진행 중)
2. 환율 차트 기능 테스트
3. 상세 모달 및 이력 테스트
4. 리포트 PDF 생성 테스트
5. 엣지 케이스 및 오류 처리 테스트

---

## 📝 테스트 환경

- **개발 서버**: http://localhost:3005
- **데이터베이스**: Supabase (PostgreSQL)
- **브라우저**: Chrome/Edge (최신 버전)
- **환율 API**: 한국수출입은행 Open API
- **테스트 도구**:
  - Supabase SQL Editor (DB 검증)
  - Browser DevTools (Network, Console)
  - curl (API 직접 테스트)

---

**작성자**: Claude AI
**최종 업데이트**: 2025-11-06
